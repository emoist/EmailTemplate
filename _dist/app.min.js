var defaultFontFamily=["inherit","Georgia, serif","'Palatino Linotype', 'Book Antiqua', Palatino, serif","'Times New Roman', Times, serif","Arial, Helvetica, sans-serif","'Arial Black', Gadget, sans-serif","'Comic Sans MS', cursive, sans-serif","Impact, Charcoal, sans-serif","'Lucida Sans Unicode', 'Lucida Grande', sans-serif","Tahoma, Geneva, sans-serif","'Trebuchet MS', Helvetica, sans-serif","Verdana, Geneva, sans-serif","'Courier New', Courier, monospace","'Lucida Console', Monaco, monospace"],emailBuilderConfigurations={assetsPath:"http://localhost:9000/assets",authPath:"auth/layouts",containerPath:"container/layouts",defaultLayout:"modern",defaultSkin:"dark",layoutsPath:"layouts",urlToUploadImage:"//uploads.im/api",tinymceBaseUrl:"/bower_components/tinymce",translateTemplateUrl:"i18n/{part}/{lang}.json",mjmlPublicKey:"",mjmlApplicationId:"",mjmlCompileAdress:"/compile",buildFolder:"_dist",builderTitle:"Angular email builder",builderDescription:"",UA:"",exportHtml:!0,importHtml:!0,deleteAllBlocks:!0,trackEvents:!1,includeMailchimpMergeTags:!1,defaults:{newEmailName:"My new email template",emailOptions:{paddingTop:"15px",paddingRight:"10px",paddingBottom:"15px",paddingLeft:"10px",backgroundColor:"#fff",border:"1px solid #999 dashed"}},disableBlocks:[],blocks:{title:{type:"title",sort:1,element:{type:"title",icon:"&#xE165;",primary_head:"builder_el_title",second_head:"builder_el_title_comment"},defaultOptions:{align:"center",title:"Enter your title here",subTitle:"Subtitle",padding:["30px","15px","30px","15px"],backgroundColor:"#fff",font:{weight:"normal",weightOptions:["bold","bolder","lighter","inherit","initial","normal",100,200,300,400,500,600,700,800,900],family:"Arial, Helvetica, sans-serif",familyOptions:defaultFontFamily},color:"#444444"},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" align="center" style="display: table; background-color: {{ element.options.backgroundColor }}" data-type="title">\n    <tbody>\n    <tr>\n        <td align="{{  element.options.align  }}" class="title" style="padding:{{  element.options.padding | arrToPadding   }}; color: #757575;" data-block-id="background">\n            <h1 style="font-family: {{ element.options.font.family }};font-weight:  {{ element.options.font.weight }}; margin: 0; color: {{ element.options.color }};" ng-if="element.options.title.length" data-block-id="main-title">{{  element.options.title  }}</h1>\n            <h4 style="font-family: {{ element.options.font.family }};font-weight: {{ element.options.font.weight }}; margin-bottom: 0; color: {{ element.options.color }};" ng-if="element.options.subTitle.length" data-block-id="sub-title">{{  element.options.subTitle  }}</h4>\n        </td>\n    </tr>\n    </tbody>\n</table>'},button:{type:"button",sort:4,element:{type:"button",icon:"&#xE913;",primary_head:"builder_el_button",second_head:"builder_el_button_comment"},defaultOptions:{align:"center",padding:["12px","20px","12px","20px"],margin:["15px","15px","15px","15px"],buttonText:"Click me",url:"#",buttonBackgroundColor:"#3498DB",backgroundColor:"#ffffff",border:{size:1,radius:3,color:"#3498DB",style:"solid",styleOptions:["dotted","solid","dashed"]},fullWidth:!1,font:{size:15,color:"#ffffff",weight:"normal",weightOptions:["bold","bolder","lighter","inherit","initial","normal",100,200,300,400,500,600,700,800,900],family:"inherit",familyOptions:defaultFontFamily}},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" bgcolor="#FFFFFF" align="center" style="display: table; background-color: {{element.options.backgroundColor}};" data-type="button">\n    <tbody>\n    <tr>\n        <td class="buttons-full-width">\n            <table cellspacing="0" cellpadding="0" border="0" align="center" width="100%" style="text-align: {{ element.options.align }}" class="button">\n                <tbody>\n                <tr>\n                    <td class="button" style="padding: {{element.options.margin | arrToPadding}};">\n                        <a style="background-color: {{element.options.buttonBackgroundColor}};color: {{element.options.font.color}};font-family: {{element.options.font.family}};font-size: {{element.options.font.size}}px;line-height:19px;display: {{element.options.fullWidth ? \'block\' : \'inline-block\'}};border-radius: {{element.options.border.radius}}px;border: {{element.options.border.size}}px  {{element.options.border.style}}  {{element.options.border.color}};text-align: center;text-decoration: none;font-weight:  {{element.options.font.weight}};margin: 0; width: auto; padding: {{element.options.padding | arrToPadding}};" class="button-1" href="{{ element.options.url }}" data-default="1">{{ element.options.buttonText }}</a>                   \x3c!--[if mso]>             </center>           </v:roundrect>         <![endif]--\x3e\n                    </td>\n                </tr>\n                </tbody>\n            </table>\n        </td>\n    </tr>\n    </tbody>\n</table>'},text:{type:"text",sort:2,element:{type:"text",icon:"&#xE8EE;",primary_head:"builder_el_text",second_head:"builder_el_text_comment"},defaultOptions:{padding:["10px","15px","10px","15px"],backgroundColor:"#ffffff",font:{family:"inherit",familyOptions:defaultFontFamily},text:'<p style="margin: 0">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>'},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" style="display: table; background-color: {{element.options.backgroundColor}}" align="center" data-type="text-block">\n    <tbody>\n    <tr>\n        <td class="block-text" data-block-id="background" data-clonable="true" align="left" style="padding:{{element.options.padding | arrToPadding}}; font-size: 13px; color: #000000; line-height: 20px;font-family: {{element.options.font.family}}"\n      ui-tinymce="tinymceOptions"    ng-model="element.options.text">\n        </td>\n    </tr>\n    </tbody>\n</table>'},social:{type:"social",sort:10,element:{type:"social",icon:"share",primary_head:"social_icons",second_head:"social_icons_comment"},defaultOptions:{align:"center",padding:["10px","15px","10px","15px"],backgroundColor:"#eeeeee",links:{facebook:{link:"https://www.facebook.com/envato",active:!0},twitter:{link:"https://twitter.com/envatomarket",active:!0},linkedin:{link:"",active:!1},youtube:{link:"https://www.youtube.com/user/Envato",active:!0}}},template:'<table class="main" align="center" width="100%" cellspacing="0" cellpadding="0" border="0" ng-style="{backgroundColor: element.options.backgroundColor}" style="display: table;" data-type="social-links">\n    <tbody>\n    <tr>\n        <td class="social" align="{{element.options.align}}" style="padding: {{ element.options.padding | arrToPadding  }}">\n            <a href="{{element.options.links.facebook.link}}" target="_blank" style="border: none;text-decoration: none;" class="facebook">\n                <img border="0" ng-if="element.options.links.facebook.active" src="assets/social/facebook.png">\n            </a>\n            <a href="{{element.options.links.twitter.link}}" target="_blank" style="border: none;text-decoration: none;" class="twitter">\n                <img border="0" ng-if="element.options.links.twitter.active" src="assets/social/twitter.png">\n            </a>\n            <a href="{{element.options.links.linkedin.link}}" target="_blank" style="border: none;text-decoration: none;" class="linkedin">\n                <img border="0" ng-if="element.options.links.linkedin.active" src="assets/social/linkedin.png">\n            </a>\n            <a href="{{element.options.links.youtube.link}}" target="_blank" style="border: none;text-decoration: none;" class="youtube">\n                <img border="0" ng-if="element.options.links.youtube.active" src="assets/social/youtube.png">\n            </a>\n        </td>\n    </tr>\n    </tbody>\n</table>'},divider:{type:"divider",sort:3,element:{type:"divider",icon:"&#xE8E9;",primary_head:"builder_el_divider",second_head:"builder_el_divider_comment"},defaultOptions:{padding:["15px","15px","15px","15px"],backgroundColor:"#ffffff",border:{size:1,style:"solid",styleOptions:["solid","dashed","dotted"],color:"#DADFE1"}},template:'<table class="main" width="100%" style="border: 0; display: table; background-color: {{element.options.backgroundColor}};" cellspacing="0" cellpadding="0" border="0" align="center" data-type="divider">\n    <tbody>\n    <tr>\n        <td class="divider-simple" style="padding: {{ element.options.padding | arrToPadding  }};">\n            <table width="100%" cellspacing="0" cellpadding="0" border="0" style="border-top: {{element.options.border.size}}px {{element.options.border.style}} {{element.options.border.color}};">\n                <tbody>\n                <tr>\n                    <td width="100%"></td>\n                </tr>\n                </tbody>\n            </table>\n        </td>\n    </tr>\n    </tbody>\n</table>'},image:{type:"image",sort:5,element:{type:"image",icon:"&#xE40B;",primary_head:"builder_el_image",second_head:"builder_el_image_comment"},defaultOptions:{align:"center",padding:["15px","15px","15px","15px"],image:"assets/350x150.jpg",width:"370",backgroundColor:"#ffffff",altTag:"",linkTo:{type:"none",typeOptions:["link","email","none"],link:""}},template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" align="center" style="display: table; background-color: {{element.options.backgroundColor}};" data-type="image">\n    <tbody>\n    <tr>\n        <td align="{{ element.options.align }}" style="padding: {{ element.options.padding | arrToPadding  }};" class="image">\n          <img border="0" align="one_image" image-with-link link="element.options.linkTo" style="display:block;max-width:100%;" ng-style="{width: element.options.width}" alt="{{element.options.altTag}}" ng-src="{{ element.options.image }}" tabindex="0">       </td>\n    </tr>\n    </tbody>\n</table>'},imageTextRight:{type:"imageTextRight",sort:6,element:{type:"imageTextRight",icon:"format_textdirection_l_to_r",primary_head:"builder_el_image_text_right",second_head:"builder_el_image_text_right_comment"},defaultOptions:{padding:["15px","15px","15px","15px"],image:"assets/340x145.jpg",width:"340",backgroundColor:"#ffffff",altTag:"",linkTo:{type:"none",typeOptions:["link","email","none"],link:""},text:'<p style="line-height: 20px;margin:0">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam.</p>'},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" bgcolor="{{element.options.backgroundColor}}" align="center">\n                  <tbody>\n                    <tr style="padding: {{ element.options.padding | arrToPadding }}; display: table-cell; font-family: Arial; font-size: 13px; color: #000000; line-height: 20px;">\n                      <td width="295">\n                        <img image-with-link link="element.options.linkTo" border="0" ng-src="{{ element.options.image }}" width="{{ element.options.width }}" style="display: block;margin: 0px;max-width: 100%;padding:0;">\n                      </td>\n                      <td width="10"></td>\n                      <td width="295" valign="top" ui-tinymce="tinymceOptions" ng-model="element.options.text"></td>\n                    </tr>\n                  </tbody>\n                </table>'},imageTextLeft:{type:"imageTextLeft",sort:7,element:{type:"imageTextLeft",icon:"format_textdirection_r_to_l",primary_head:"builder_el_image_text_left",second_head:"builder_el_image_text_left_comment"},defaultOptions:{padding:["15px","15px","15px","15px"],image:"assets/340x145.jpg",width:"340",backgroundColor:"#ffffff",altTag:"",linkTo:{type:"none",typeOptions:["link","email","none"],link:""},text:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam.</p>'},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" bgcolor="{{element.options.backgroundColor}}" align="center">\n                    <tbody>\n                      <tr style="padding: {{ element.options.padding | arrToPadding }}; display: table-cell; font-family: Arial; font-size: 13px; color: #000000; line-height: 20px;">\n                        <td width="295" valign="top" ui-tinymce="tinymceOptions" ng-model="element.options.text"></td>\n                        <td width="10px"></td>\n                        <td width="295">\n                          <img image-with-link link="element.options.linkTo" border="0" ng-src="{{ element.options.image }}" width="{{ element.options.width }}" style="display: block;margin: 0px;max-width: 100%;padding:0;">\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>'},imageText2x2:{type:"imageText2x2",sort:8,element:{type:"imageText2x2",icon:"text_fields",primary_head:"builder_el_image_text_2x2",second_head:"builder_el_image_text_2x2_comment"},defaultOptions:{padding:["15px","15px","15px","15px"],image1:"assets/255x154.jpg",image2:"assets/255x154.jpg",width1:"255",width2:"255",backgroundColor:"#ffffff",altTag1:"",altTag2:"",linkTo1:{type:"none",typeOptions:["link","email","none"],link:""},linkTo2:{type:"none",typeOptions:["link","email","none"],link:""},text1:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>',text2:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>'},template:'<table class="main" width="100%" cellspacing="0" cellpadding="0" border="0" bgcolor="{{element.options.backgroundColor}}" align="center" data-type="imageText2x2Template">\n                    <tbody style="display: table-cell;padding: {{ element.options.padding | arrToPadding }}">\n                      <tr>\n                        <td width="295" style="padding-left: 5px;"> \n                          <img image-with-link link="element.options.linkTo1" ng-src="{{ element.options.image1 }}" width="{{ element.options.width1 }}" alt="{{element.options.altTag1}}" style="max-width: 100%" border="0">\n                        </td>\n                        <td width="10"></td>\n                        <td width="295" style="padding-right: 5px;"> \n                          <img image-with-link link="element.options.linkTo2" ng-src="{{ element.options.image2 }}" width="{{ element.options.width2 }}" alt="{{element.options.altTag2}}" style="max-width: 100%" border="0">                \n                        </td>\n                      </tr>\n                      <tr>\n                        <td width="295" align="left" style="font-family: Arial;font-size: 13px;color: #000000;line-height: 20px;padding-left: 5px;" ui-tinymce="tinymceOptions" ng-model="element.options.text1"></td>\n                        <td width="10"></td>\n                        <td width="295" align="left" style="font-family: Arial;font-size: 13px;color: #000000;line-height: 20px;padding-right: 5px;" ui-tinymce="tinymceOptions" ng-model="element.options.text2"></td>\n                      </tr>\n                    </tbody>\n                  </table>'},imageText3x2:{type:"imageText3x2",sort:9,element:{type:"imageText3x2",icon:"wrap_text",primary_head:"builder_el_image_text_3x2",second_head:"builder_el_image_text_3x2_comment"},defaultOptions:{padding:["15px","15px","15px","15px"],image1:"assets/154x160.jpg",image2:"assets/154x160.jpg",image3:"assets/154x160.jpg",width1:"154",width2:"154",width3:"154",backgroundColor:"#ffffff",altTag1:"",altTag2:"",altTag3:"",linkTo1:{type:"none",typeOptions:["link","email","none"],link:""},linkTo2:{type:"none",typeOptions:["link","email","none"],link:""},linkTo3:{type:"none",typeOptions:["link","email","none"],link:""},text1:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>',text2:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>',text3:'<p style="line-height: 20px;margin:0"">Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>'},template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" bgcolor="{{element.options.backgroundColor}}" align="center" data-type="imageText3x2">\n                    <tbody>\n                      <tr>\n                        <td valign="top" width="100%">\n                          <div style="display: flex; padding: {{ element.options.padding | arrToPadding }};">\n                            <div style="flex: 1 1 100%; display: flex; flex-direction: column;padding: 0 3px;">\n                              <img style="max-width: 100%; padding-bottom: 3px;display: block;margin: 0 auto;" image-with-link link="element.options.linkTo1" ng-src="{{ element.options.image1 }}" width="{{ element.options.width1 }}" alt="{{element.options.altTag1}}" border="0">\n                              <div style="font-family: Arial, serif; font-size: 13px; color: #000000; line-height: 20px" ui-tinymce="tinymceOptions" ng-model="element.options.text1"></div>\n                            </div>\n                            <div style="flex: 1 1 100%; display: flex; flex-direction: column;padding: 0 3px;">\n                              <img style="max-width: 100%; padding-bottom: 3px;display: block;margin: 0 auto;" image-with-link link="element.options.linkTo2" ng-src="{{ element.options.image2 }}" width="{{ element.options.width2 }}" alt="{{element.options.altTag2}}" border="0">\n                              <div style="font-family: Arial, serif; font-size: 13px; color: #000000; line-height: 20px" ui-tinymce="tinymceOptions" ng-model="element.options.text2"></div>\n                            </div>\n                            <div style="flex: 1 1 100%; display: flex; flex-direction: column;padding: 0 3px;">\n                              <img style="max-width: 100%; padding-bottom: 3px;display: block;margin: 0 auto;" image-with-link link="element.options.linkTo3" ng-src="{{ element.options.image3 }}" width="{{ element.options.width3 }}" alt="{{element.options.altTag3}}" border="0">\n                              <div style="font-family: Arial, serif; font-size: 13px; color: #000000; line-height: 20px" ui-tinymce="tinymceOptions" ng-model="element.options.text3"></div>\n                            </div>\n                          </div>\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>'}}};"undefined"!=typeof module&&(module.exports=emailBuilderConfigurations),angular.module("email.auth",[]),angular.module("email.main",[]),angular.module("email.directives",[]),angular.module("email.filters",[]),angular.module("email",["ngRoute","ngMaterial","angular-jwt","angular-storage","email.auth","email.main","email.directives","email.filters"]).config(["$locationProvider","jwtInterceptorProvider","$routeProvider","$httpProvider",function(t,e,i,n){i.otherwise({redirectTo:"/"}),t.hashPrefix("!")}]).run(["$rootScope","store","jwtHelper","$location",function(t,e,i,n){t.$on("$routeChangeStart",function(t,o){o.data&&o.data.requiresLogin&&(e.get("jwt")&&!i.isTokenExpired(e.get("jwt"))||(t.preventDefault(),e.remove("jwt"),n.path("/login")))})}]),angular.module("email.directives",["ngRoute",angularDragula(angular),"pascalprecht.translate","ui.tinymce","ngSanitize","ngAlertify","colorpicker.module"]).constant("variables",emailBuilderConfigurations).value("uiTinymceConfig",{baseUrl:emailBuilderConfigurations.tinymceBaseUrl,format:"raw"}).directive("mdInput",["$timeout",function(t){return{restrict:"A",controller:["$scope","$element",function(t,e){var i=$(e);t.updateInput=function(){i.closest(".md-input-wrapper").removeClass("md-input-wrapper-danger md-input-wrapper-success md-input-wrapper-disabled"),i.hasClass("md-input-danger")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-danger"),i.hasClass("md-input-success")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-success"),i.prop("disabled")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-disabled"),i.hasClass("label-fixed")&&i.closest(".md-input-wrapper").addClass("md-input-filled"),""!==i.val()&&i.closest(".md-input-wrapper").addClass("md-input-filled")}}],link:function(e,i,n){var o=$(i);t(function(){o.hasClass("md-input-processed")||(o.prev("label").length?o.prev("label").addBack().wrapAll('<div class="md-input-wrapper"/>'):o.wrap('<div class="md-input-wrapper"/>'),o.addClass("md-input-processed").closest(".md-input-wrapper").append('<span class="md-input-bar"/>')),e.updateInput()},100),e.$watch(function(){return o.attr("class")},function(t,i){t!=i&&e.updateInput()}),e.$watch(function(){return o.val()},function(t,i){o.is(":focus")||t==i||e.updateInput()}),o.on("focus",function(){o.closest(".md-input-wrapper").addClass("md-input-focus")}).on("blur",function(){t(function(){o.closest(".md-input-wrapper").removeClass("md-input-focus"),""===o.val()?o.closest(".md-input-wrapper").removeClass("md-input-filled"):o.closest(".md-input-wrapper").addClass("md-input-filled")},100)})}}}]).directive("inputFileUpload",["utils","variables","$timeout",function(t,e,i){return{restrict:"E",replace:!0,scope:{element:"=",model:"="},template:'\n                    <div>\n                        <div class="upload">\n                            <div class="current-image">\n                                <img ng-src="{{thumb || model}}" alt="" />\n                            </div>\n                            <div class="upload-image">\n                                <p>Upload an image</p>\n                                <a onclick="return false" href="#">Browse</a>\n                            </div>\n                            <div class="uploading">\n                                <i class="material-icons icon-spin">hdr_strong</i>\n                            </div>\n                        </div>\n                        <input type="text" class="md-input" ng-model="model" />\n                    </div>\n                ',link:function(i,n,o){var a=$(n).find(".upload-image a"),l=$(n).find(".uploading"),r=$("<input/>",{type:"file",name:"file"}).on("change",function(n){if(!e.urlToUploadImage)throw Error("You don't set the 'urlToUploadImage' in variables.");var o=$(n.target);o.prop("disabled",!0),a.text(t.translate("uploading")),l.addClass("active");var r=new FormData;return r.append("upload",n.target.files[0]),$.ajax({url:e.urlToUploadImage,data:r,processData:!1,contentType:!1,type:"POST",success:function(e){200==e.status_code?(n.target.value=null,i.$evalAsync(function(){i.model=e.data.img_url,i.thumb=e.data.thumb_url,i.element.hasOwnProperty("width")&&(i.element.width=e.data.img_width)}),t.notify(t.translate("your_image_has_been_uploaded")).log()):t.notify(e.status_txt).error()},error:function(e){t.notify(e.statusText).error()},complete:function(){o.prop("disabled",!1),a.text(t.translate("browse")),l.removeClass("active")}})});a.on("click",function(i){return i.preventDefault(),/uploads.im/.test(e.urlToUploadImage)&&"https:"==location.protocol?t.notify("Sorry, but uploads.im don't support https!").error():r.click()})}}}]).directive("imageWithLink",[function(){return{restrict:"A",transclude:!0,scope:{link:"="},link:function(t,e,i){t.$watch(function(){return t.link.type},function(i){"none"!==i?($(e).unwrap("a"),$(e).wrap($("<a/>",{href:"link"==i?t.link.link:"mailto:"+t.link.link,target:"_blank"}).on("click",function(t){t.preventDefault()}))):$(e).unwrap("a")}),t.$watch(function(){return t.link.link},function(i){$(e).closest("a").attr("href","link"==t.link.type?i:"mailto:"+i)})}}}]).directive("colorInput",function(){return{restrict:"E",replace:!0,template:'\n                <div>\n                    <div class="current-color" ng-style="{ backgroundColor: model }"></div>\n                    <input ng-model="model" colorpicker colorpicker-position="top" type="text" />\n                </div>\n            ',scope:{model:"="},link:function(t,e,i){$(e).on("click",".current-color",function(){return $(e).find("input:text").click()}),$(e).find("input:text").on("focus",function(){$(e).addClass("focussed")}).on("focusout",function(){$(e).removeClass("focussed")})}}}).directive("mobilePreview",["$timeout",function(t){return{restrict:"E",replace:!0,scope:{email:"="},template:'\n                <iframe width="320"></iframe>\n            ',link:function(e,i,n){e.insertHtml=function(t){i[0].contentWindow.document.open(),i[0].contentWindow.document.write(t),i[0].contentWindow.document.close()},t(function(){e.$watch(function(){return e.email.html},e.insertHtml)})}}}]).filter("arrToPadding",function(){return function(t){var e="";return t.forEach(function(t){e+=t?t+" ":"0 "}),e}}).filter("hexToRgb",function(){return function(t,e){var i=t.replace("#","");i=i.match(new RegExp("(.{"+i.length/3+"})","g"));for(var n=0;n<i.length;n++)i[n]=parseInt(1==i[n].length?i[n]+i[n]:i[n],16);return void 0!==e&&(e/=100,i.push(e)),"rgba("+i.join(",")+")"}}).filter("translateCamelCase",["utils",function(t){return function(e,i){if("string"!=typeof e)return e;var n=t.camelToSnake(e),o=t.translate(n,i);return o===n?e:o}}]).filter("rawHtml",["$sce",function(t){var e=document.createElement("div");return function(i,n){return n?(e.innerHTML=i,t.trustAsHtml(e.textContent)):t.trustAsHtml(i)}}]).factory("utils",["$filter","alertify","variables",function(t,e,i){var n=this;return n.utils={translate:function(e,i){return t("translate")(e,i)},snakeToCamel:function(t){return"string"!=typeof t?t:t.replace(/_([a-z])/gi,function(t,e){return""+e.toUpperCase()})},camelToSnake:function(t){return"string"!=typeof t?t:t.replace(/([A-Z])/g,function(t,e){return"_"+e.toLowerCase()})},uid:function(t){return(t||"id")+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())},findWhere:function(t,e){for(var i,n,o=0,a=t.length,l=!1;o<a;o++){i=t[o];for(n in e)if(e.hasOwnProperty(n)){if(!i.hasOwnProperty(n)){l=!1;break}if(e[n]!==i[n]){l=!1;break}l=!0}if(l)return i}return null},createEmail:function(t){t=t||{};var e={tagName:"mjml",children:[{tagName:"mj-head",children:[{tagName:"mj-title",content:t.name},{tagName:"mj-style",attributes:{},content:"@media all and (max-width: 480px) {\n                                    td {\n                                        width: 100%!important;\n                                    }\n                                }"}]},{tagName:"mj-body",attributes:{},children:[{tagName:"mj-container",attributes:{"background-color":t.emailSettings.options.backgroundColor},children:[{tagName:"mj-wrapper",attributes:{"padding-top":t.emailSettings.options.paddingTop,"padding-right":t.emailSettings.options.paddingRight,"padding-bottom":t.emailSettings.options.paddingBottom,"padding-left":t.emailSettings.options.paddingLeft},children:t.elements.map(function(t){switch(t.type){case"title":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",attributes:{width:"100%"},children:[{tagName:"mj-text",attributes:{color:t.options.color,align:t.options.align,padding:0,"font-family":t.options.font.family,"line-height":0},content:'<h1 style="font-weight: '+t.options.font.weight+';font-size: 32px;line-height: 1;margin: 0;">'+t.options.title+"</h1>"}]},{tagName:"mj-column",attributes:{width:"100%"},children:[{tagName:"mj-text",attributes:{color:t.options.color,align:t.options.align,padding:0,"font-family":t.options.font.family},content:'<h4 style="font-weight: '+t.options.font.weight+';margin-bottom: 0;font-size: 16px;">'+t.options.subTitle+"</h4>"}]}]};case"button":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:0},children:[{tagName:"mj-column",attributes:{width:"100%"},children:[{tagName:"mj-button",attributes:{align:t.options.align,border:t.options.border.size+"px "+t.options.border.style+" "+t.options.border.color,"border-radius":t.options.border.radius+"px","background-color":t.options.buttonBackgroundColor,"font-family":""+t.options.font.family,color:t.options.font.color,"font-size":t.options.font.size+"px","font-weight":t.options.font.weight,width:Boolean(t.options.fullWidth)?"100%":"auto",padding:t.options.margin[0]+" "+t.options.margin[1]+" "+t.options.margin[2]+" "+t.options.margin[3],"inner-padding":t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3],href:t.options.url},content:t.options.buttonText}]}]};case"text":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:0,"font-family":t.options.font.family},content:t.options.text}]}]};case"divider":return{tagName:"mj-section",attributes:{"full-width":"full-width",padding:0},children:[{tagName:"mj-column",children:[{tagName:"mj-divider",attributes:{padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3],
"container-background-color":t.options.backgroundColor,"border-width":t.options.border.size+"px","border-style":""+t.options.border.style,"border-color":""+t.options.border.color}}]}]};case"image":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{align:t.options.align,src:t.options.image,alt:t.options.altTag,width:t.options.width,padding:0,href:"link"===t.options.linkTo.type&&t.options.linkTo.link||"email"===t.options.linkTo.type&&"mailto:"+t.options.linkTo.link||null}}]}]};case"imageTextRight":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{align:t.options.align,src:t.options.image,alt:t.options.altTag,padding:0,"padding-right":"5px",width:t.options.width,href:"link"===t.options.linkTo.type&&t.options.linkTo.link||"email"===t.options.linkTo.type&&"mailto:"+t.options.linkTo.link||null}}]},{tagName:"mj-column",children:[{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:0,"padding-left":"5px","font-family":"Arial, sans-serif"},content:t.options.text}]}]};case"imageTextLeft":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:0,"padding-right":"5px","font-family":"Arial, sans-serif"},content:t.options.text}]},{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{align:t.options.align,src:t.options.image,alt:t.options.altTag,padding:0,"padding-left":"5px",width:t.options.width,href:"link"===t.options.linkTo.type&&t.options.linkTo.link||"email"===t.options.linkTo.type&&"mailto:"+t.options.linkTo.link||null}}]}]};case"imageText2x2":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{src:t.options.image1,alt:t.options.altTag1,padding:"0 5px",width:t.options.width1,href:"link"===t.options.linkTo1.type&&t.options.linkTo1.link||"email"===t.options.linkTo1.type&&"mailto:"+t.options.linkTo1.link||null}},{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:"0 5px","font-family":"Arial, sans-serif"},content:t.options.text1}]},{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{src:t.options.image2,alt:t.options.altTag2,padding:"0 5px",width:t.options.width2,href:"link"===t.options.linkTo2.type&&t.options.linkTo2.link||"email"===t.options.linkTo2.type&&"mailto:"+t.options.linkTo2.link||null}},{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:"0 5px","font-family":"Arial, sans-serif"},content:t.options.text2}]}]};case"imageText3x2":return{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{src:t.options.image1,alt:t.options.altTag1,padding:"0 3px 3px",width:t.options.width1,href:"link"===t.options.linkTo1.type&&t.options.linkTo1.link||"email"===t.options.linkTo1.type&&"mailto:"+t.options.linkTo1.link||null}},{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:"0 3px","font-family":"Arial, sans-serif"},content:t.options.text1}]},{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{src:t.options.image2,alt:t.options.altTag2,padding:"0 3px 3px",width:t.options.width2,href:"link"===t.options.linkTo2.type&&t.options.linkTo2.link||"email"===t.options.linkTo2.type&&"mailto:"+t.options.linkTo2.link||null}},{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:"0 3px","font-family":"Arial, sans-serif"},content:t.options.text2}]},{tagName:"mj-column",children:[{tagName:"mj-image",attributes:{src:t.options.image3,alt:t.options.altTag3,padding:"0 3px 3px",width:t.options.width3,href:"link"===t.options.linkTo3.type&&t.options.linkTo3.link||"email"===t.options.linkTo3.type&&"mailto:"+t.options.linkTo3.link||null}},{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:"0 3px","font-family":"Arial, sans-serif"},content:t.options.text3}]}]};case"social":var e="";return Object.keys(t.options.links).forEach(function(n){t.options.links[n].active&&(e+='<a href="'+t.options.links[n].link+'" target="_blank" style="border: none;text-decoration: none;">\n                                                                <img border="0" src="'+i.assetsPath+"/social/"+n+'.png">\n                                                             </a>')}),{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":t.options.backgroundColor,padding:t.options.padding[0]+" "+t.options.padding[1]+" "+t.options.padding[2]+" "+t.options.padding[3]},children:[{tagName:"mj-column",attributes:{width:"100%"},children:[{tagName:"mj-text",attributes:{color:t.options.color,align:t.options.align,padding:0,"font-family":"Arial, sans-serif","line-height":0},content:e}]}]};default:return!1}})}]}]}]};return new Promise(function(t,n){return i.mjmlCompileAdress||i.mjmlPublicKey&&i.mjmlApplicationId?i.mjmlPublicKey&&i.mjmlApplicationId?$.ajax({url:"https://api.mjml.io/v1/render",method:"POST",data:JSON.stringify({mjml:JSON.stringify(e)}),datatype:"json",processData:!1,beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+btoa(i.mjmlApplicationId+":"+i.mjmlPublicKey))},success:function(e){return t(e)}}):$.post(i.mjmlCompileAdress,JSON.stringify(e)).then(t):n("You did'nt include compile address for MJML or MJML API keys!")})},notify:function(t,i){return{log:function(){return e.log(t,i)},success:function(){e.success(t,i)},error:function(){e.error(t,i)}}},confirm:function(t,i,n,o,a){return e.okBtn(o).cancelBtn(a).confirm(t,i,n)},alert:function(t){return e.okBtn("Accept").alert(t)},prompt:function(t,i,n,o){return e.defaultValue(t).prompt(i,n,o)},validateEmail:function(t){return angular.isObject(t)&&angular.isArray(t.elements)&&angular.isString(t.html)&&angular.isObject(t.emailSettings)&&"emailSettings"==t.emailSettings.type&&angular.isObject(t.emailSettings.options)},trackEvent:function(t,e,n){return i.trackEvents&&window.ga?window.ga("send","event",t,e,n):i.trackEvents&&!window.ga?console.info("To track events, add Google UA in config.json file!"):void 0},removeLineBreaks:function(t){return t.replace(/\n\s*\n/gi,"\n")}},n.utils}]).factory("storage",["utils","variables","$http","store","jwtHelper","$location",function(t,e,i,n,o,a){"use strict";var l=n.get("jwt"),r=l&&o.decodeToken(l),s={name:e.defaults.newEmailName,elements:[],html:"",emailSettings:{options:e.defaults.emailOptions,type:"emailSettings"}},d=this;return d.opts={get:function(e){return new Promise(function(n,o){try{if("create"==e){var l={is_template:0,template:JSON.parse(JSON.stringify(s))};n(l)}else i.post("/emails/"+e,{user_id:r.id}).then(function(t){var e=t.data;e.template=JSON.parse(decodeURI(e.template))||s,n(e)},function(e){t.notify(e.data).error(),a.path("/emails")})}catch(e){t.notify(e).error()}})},put:function(e,n){return new Promise(function(o,a){try{e.html=t.removeLineBreaks(e.html),"create"==n?i.post("/emails/create",{template:encodeURI(JSON.stringify(e)),user_id:r.id}).then(function(t){o(t.data)},function(e){t.notify(e.data).error()}):i.post("/emails/update",{template:encodeURI(JSON.stringify(e)),id:n}).then(function(t){o()},function(e){t.notify(e.data).error()})}catch(e){t.notify(e).error(),a(e)}})},delete:function(){return new Promise(function(t,e){t(JSON.parse(JSON.stringify(s)))})}},d.opts}]).config(["$translateProvider","$translatePartialLoaderProvider","$sceDelegateProvider","$compileProvider","variables",function(t,e,i,n,o){i.resourceUrlWhitelist(["self"]),n.debugInfoEnabled(!1),e.addPart("builder"),t.useLoader("$translatePartialLoader",{urlTemplate:o.translateTemplateUrl}),t.preferredLanguage("en"),t.useSanitizeValueStrategy("sanitize"),t.fallbackLanguage("en"),t.useSanitizeValueStrategy("escape")}]).run(["$templateCache","variables",function(t,e){Object.keys(e.blocks).forEach(function(i){return-1===e.disableBlocks.indexOf(i)&&t.put(e.blocks[i].type+"Template",e.blocks[i].template)})}]).directive("emailBuilder",["variables",function(t){return{restrict:"E",templateUrl:"directives/builder/layouts/"+t.defaultLayout+"/builder.html",controller:["$scope","utils","storage","dragulaService","$interpolate","$translate","$templateCache","variables","$routeParams","store","$location",function(t,e,i,n,o,a,l,r,s,d,p){t.email_id=s.id,t.detailEnable=!1,t.backToElements=function(){t.detailEnable=!1},i.get(t.email_id).then(function(e){t.Email=JSON.parse(JSON.stringify(e.template)),t.cloneEmail=JSON.parse(JSON.stringify(e.template)),t.$evalAsync(function(){t.currentElement=t.Email.emailSettings}),1==e.is_template&&(t.email_id="create")}),t.elements=Object.keys(r.blocks).map(function(t){return r.blocks[t].element}).sort(function(t,e){return r.blocks[t.type].sort-r.blocks[e.type].sort}).filter(function(t){return-1===r.disableBlocks.indexOf(t.type)}),t.getVariable=function(t){return r[t]},t.currentLanguage="en",t.tinymceOptions={inline:!0,skin:"lightgray",theme:"modern",plugins:["advlist autolink lists link image charmap","searchreplace visualblocks code","insertdatetime media table contextmenu paste","textcolor"],toolbar:"undo redo | bold italic fontsizeselect forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | link",fontsize_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 24pt 36pt"},r.includeMailchimpMergeTags&&(t.tinymceOptions=angular.extend(t.tinymceOptions,{setup:function(t){t.addButton("mailchimpMergeTags",{type:"menubutton",text:"Merge Tags",icon:!1,menu:["*|FNAME|*","*|LNAME|*","*|EMAIL|*","*|LIST:NAME|*","*|LIST:COMPANY|*","*|LIST:SUBSCRIBERS|*","*|USER:COMPANY|*","*|USER:ADDRESS|*","*|USER:PHONE|*","*|MC:DATE|*","*|CURRENT_YEAR|*","*|UNSUB|*","*|UPDATE_PROFILE|*"].map(function(e){return{text:e,onclick:function(){t.insertContent(e)}}})})}})),t.addSocialNetwork=function(t,e){e&&(t[e].active=!0)},t.getTemplate=function(t){return t?t+"Template":"textTemplate"},t.removeElement=function(i){return e.confirm(e.translate("are_you_sure"),function(){var n=e.findWhere(t.Email.elements,{id:i});t.Email.elements.splice(t.Email.elements.indexOf(n),1),e.trackEvent("Elements","remove",n.type),t.currentElement=t.Email.emailSettings,t.$apply()},null,e.translate("delete_element"),e.translate("do_not_remove_element"))},t.cloneElement=function(i){var n=e.findWhere(t.Email.elements,{id:i}),o=JSON.parse(JSON.stringify(n));o.id=e.uid(),e.trackEvent("Elements","clone",o.type),t.Email.elements.splice(t.Email.elements.indexOf(n)+1,0,o)},t.editElement=function(i){if(t.detailEnable=!0,!i)return t.currentElement=t.Email.emailSettings;t.preview||(t.currentElement="emailSettings"!=i?e.findWhere(t.Email.elements,{id:i}):t.Email[i],t.currentElement&&e.trackEvent("Email","edit",t.currentElement.type))},t.changeLanguage=function(e){return t.currentLanguage=e,a.use(e)},t.hasChanges=function(){return!angular.equals(t.Email,t.cloneEmail)},t.saveEmailTemplate=function(){e.createEmail(t.Email).then(function(n){if(n.errors.length)return e.notify(n.errors.map(function(t){return t.message}).join("<br>")).error();t.Email.html=n.html,i.put(t.Email,t.email_id).then(function(i){e.notify(e.translate("email_saved")).success(),e.trackEvent("Email","saved"),t.cloneEmail=JSON.parse(JSON.stringify(t.Email)),t.$evalAsync(function(){t.currentElement=t.Email.emailSettings}),"create"==t.email_id&&p.path("/emails/"+i.insertId)})},function(t){return e.notify(t).error()})},t.openExportContainer=function(){if(!t.Email.elements.length)return e.notify(e.translate("nothing_to_export")).log();t.exportAsHtml=!1,t.currentElement="export"},t.exportEmailAsJson=function(){var i=document.createElement("a");i.target="_blank",e.trackEvent("Email","export","JSON"),i.href="data:attachment/json,"+encodeURI(JSON.stringify(t.Email)),i.download=e.uid("export")+".json",document.body.appendChild(i),i.click(),document.body.removeChild(i)},t.downloadHtml=function(){var i=document.createElement("a");i.target="_blank",e.trackEvent("Email","export","HTML"),i.href="data:attachment/html,"+encodeURI(t.Email.html),i.download=e.uid("export")+".html",document.body.appendChild(i),i.click(),document.body.removeChild(i)},t.importEmail=function(){var i=$("<input />",{type:"file",name:"import-file"}).on("change",function(){var i=new FileReader;i.onload=function(){var o=JSON.parse(i.result);e.validateEmail(o)?(e.trackEvent("Email","import"),t.$evalAsync(function(){t.currentElement=void 0,t.Email=o,t.cloneEmail=JSON.parse(JSON.stringify(o))}),e.notify(e.translate("email_has_been_imported",{lastModified:new Date(n.lastModified).toLocaleString()})).success()):e.notify(e.translate("imported_data_isnt_valid")).error()};var n=this.files[0];if("json"!==n.name.slice(-4))return e.notify(e.translate("invalid_format_file")).log();i.readAsText(n)});return t.Email.elements.length?e.confirm(e.translate("before_import"),function(){return i.click()},function(){return e.notify(e.translate("import_canceled")).log()},e.translate("accept"),e.translate("deny")):i.click()},t.previewEmail=function(){if(!t.Email.elements.length)return e.notify(e.translate("nothing_to_preview")).log();e.trackEvent("Email","preview"),t.preview=!0,t.currentElement=void 0},t.$watch("preview",function(t){tinymce.editors.forEach(function(e){return e[t?"hide":"show"]()})}),t.mobilePreview=!1,t.deleteAllElements=function(){return e.confirm(e.translate("before_delete_all_elements"),function(){return i.delete().then(function(e){t.$evalAsync(function(){t.currentElement=void 0,t.Email=e,t.cloneEmail=JSON.parse(JSON.stringify(e))})})},null,e.translate("accept"),e.translate("deny"))},n.options(t,"element",{isContainer:function(t){return t.classList.contains("email-content")},copy:!0,copySortSource:!1,removeOnSpill:!0,moves:function(t,e,i,n){return!$(e).hasClass("email-content")},invalid:function(t,e){return!1}}),n.options(t,"element-html",{copy:!1,copySortSource:!1,moves:function(t,e,i,n){return $(i).hasClass("move")},invalid:function(t,e){return!1}}),t.$on("element.drop",function(i,n,o,a,l){var s=$(n).data("type"),d=$.extend(!0,{},{type:s,options:r.blocks[s].defaultOptions});d.id=e.uid();var p=$(l).index();$(".email-content li").remove(),-1==p?t.Email.elements.push(d):t.Email.elements.splice(p-1,0,d),e.trackEvent("Elements","drop",d.type),t.$apply()}),t.$on("element-html.drop",function(i,n,o,a,l){var r=$(n).attr("id"),s=$(l).index();-1==s?s=t.Email.elements.length-1:s--;var d=e.findWhere(t.Email.elements,{id:r}),p=t.Email.elements.indexOf(d);if(s>=t.Email.elements.length)for(var m=s-t.Email.elements.length;1+m--;)t.Email.elements.push(void 0);return t.Email.elements.splice(s,0,t.Email.elements.splice(p,1)[0]),t.$apply(),!1})}]}}]),angular.module("email.directives").constant("variables",emailBuilderConfigurations).directive("emailsList",function(){return{restrict:"E",templateUrl:"directives/list/list.html",controller:["$scope","$http","store","jwtHelper",function(t,e,i,n){t.user_emails={},t.init=function(){e.get("/emails/non_templates").then(function(e){t.filterEmails(e.data)},function(e){t.error=e.data})},t.filterEmails=function(e){for(var o,a,l=i.get("jwt"),r=l&&n.decodeToken(l),s=r.fName+" "+r.lName,d={},p=0;p<e.length;p++)o=e[p],d[o.user_id]||(a=o.fName+" "+o.lName,a==s&&r.id==o.user_id&&(a="My"),d[o.user_id]={name:a,emails:[]}),d[o.user_id].emails.push(o);t.user_emails=angular.copy(d)},t.init()}]}}),angular.module("email.directives").constant("variables",emailBuilderConfigurations).directive("emailsSample",function(){return{restrict:"E",templateUrl:"directives/samples/template.html",controller:["$scope","$http",function(t,e){t.sample_templates=[],t.init=function(){e.get("/emails/templates").then(function(e){t.sample_templates=e.data},function(e){t.error=e.data})},t.init()}]}}),angular.module("email.directives").constant("variables",emailBuilderConfigurations).directive("objectEmail",function(){return{restrict:"E",templateUrl:"directives/object-email/template.html",controller:["$scope",function(t){}]}}),angular.module("email.directives").constant("variables",emailBuilderConfigurations).directive("emailsSidebar",function(){return{restrict:"E",templateUrl:"directives/sidebar/sidebar.html",controller:["$scope",function(t){}]}}),angular.module("email.directives").constant("variables",emailBuilderConfigurations).directive("emailsNavbar",function(){return{restrict:"E",templateUrl:"directives/navbar/navbar.html",controller:["$scope",function(t){}]}}),angular.module("email.main").constant("variables",emailBuilderConfigurations).config(["$routeProvider","$locationProvider","variables",function(t,e,i){t.when("/",{templateUrl:i.containerPath+"/container.html",controller:"emailsContainerCtrl",data:{requiresLogin:!0}}).when("/emails",{templateUrl:i.containerPath+"/container.html",controller:"emailsContainerCtrl",data:{requiresLogin:!0}}).when("/emails/:id",{templateUrl:i.containerPath+"/container.html",controller:"emailsContainerCtrl",data:{requiresLogin:!0}})}]).controller("emailsContainerCtrl",["$scope","$location","$http","store","jwtHelper","$routeParams",function(t,e,i,n,o,a){t.email_block=!1,t.email_id=a.id,angular.isDefined(t.email_id)&&(t.email_block=!0),t.logout=function(){n.remove("jwt"),e.path("/")}}]),angular.module("email.auth",[]).constant("variables",emailBuilderConfigurations).config(["$routeProvider","$locationProvider","variables",function(t,e,i){t.when("/login",{templateUrl:i.authPath+"/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:i.authPath+"/register.html",controller:"registerCtrl"})}]).controller("loginCtrl",["$scope","$http","variables","store","$location",function(t,e,i,n,o){n.get("jwt")&&o.path("/emails"),t.error="",t.login=function(){0!=t.loginForm.$valid&&e.post("/auth/login",t.user).then(function(t){n.set("jwt",t.data.id_token),o.path("/emails")},function(e){t.error=e.data})}}]).controller("registerCtrl",["$scope","$http","variables","store","$location",function(t,e,i,n,o){n.get("jwt")&&o.path("/emails"),t.error="",t.register=function(){0!=t.signupForm.$valid&&e.post("/auth/register",t.user).then(function(t){n.set("jwt",t.data.id_token),o.path("/emails")},function(e){t.error=e.data})}}]),angular.module("email.filters").filter("templateName",function(){return function(t){return""!=t?JSON.parse(decodeURI(t)).name:""}});